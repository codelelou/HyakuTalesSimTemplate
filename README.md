# 概要
ウォーキングシミュレーターゲームのテンプレートです（Unreal Engine 5プロジェクトファイル）。  

サンプルプログラムはFPS視点で3D空間内の100本の蝋燭を歩いて消す百物語カウンターになっています。  
メインメニューや環境設定、コンテニュー、ポーズメニュー、インタラクト（蝋燭を消す）、ダイアログ（会話機能）、アナログ時計サンプルプログラムなどの共通システムがあらかじめ用意されています。  

このゲームテンプレートはUnreal Engine 5でのゲーム開発初心者が3Dホラーゲームのようなものを作る際のベースとして使えるように作っています。  
ゲーム開発自体が初心者という方は、過去に公開したUnreal Engine 5プロジェクトファイルの方がより簡単かと思いますので、練習として先にお試しいただくと良いかもしれません。  

- [Text3DGuesser](https://github.com/codelelou/HyakuTales) （Unreal Engine 5のインストールと配布用ファイルの作成練習用のゲームテンプレート）
- [Findloople](https://github.com/codelelou/Findloople) （プログラミング不要で8番ライクゲームも作れるゲームテンプレート）

なお共通システム・共通プログラムは『HyakuTalesSimTemplate』のものが最新のものとなっており、かつアップデートにより互換性がなくなっているものがあります。  
もし新規でオリジナルゲームを開発する際のベースとしてこれらのテンプレートを使用される場合は、『HyakuTalesSimTemplate』の使用を推奨します。  

# デモ
デモとして『[百物語シム](https://codelelou.booth.pm/items/6949715)』を作成しました。  
このテンプレートでどのような機能を実装できるのか把握しやすいかと思います。  

なおゲーム開発に興味が無くても、百物語配信などでお使いいただけます（配信許可に関してはデモのリンク先に記載しています）。  
百物語配信向けにオリジナル百物語カウンターの作成にご利用いただくことも大歓迎です（Unreal Engineはゲームエンジンですが、映画やアニメ、自動車メーカーなどゲーム以外でも多くの使用実績があります）。  

---

# 目次
- [導入（開発環境構築）](#導入開発環境構築)
- [オリジナル百物語カウンターの作り方](#オリジナル百物語カウンターの作り方)
  - [蝋燭の編集](#蝋燭の編集)
  - [メイン画面の編集](#メイン画面の編集)
  - [その他](#その他)
- [パッケージ化（配布用exeファイル作成）](#パッケージ化配布用exeファイル作成)
- [フォルダ構成（プログラムなどメインのコンテンツフォルダ）](#フォルダ構成プログラムなどメインのコンテンツフォルダ)
- [共通システム](#共通システム)
  - [インタラクション](#インタラクション)
  - [時計](#時計)
- [応用編](#応用編)
  - [国際化（多言語対応）](#国際化多言語対応)
  - [操作方法のキー設定](#操作方法のキー設定)
  - [ゲームの画質について](#ゲームの画質について)
  - [サウンドの種類の設定方法](#サウンドの種類の設定方法)
  - [フォント](#フォント)
- [よくある質問](#よくある質問)

---

# 導入（開発環境構築）
Unreal Engine 5プロジェクトファイルを編集するためにUnreal Engine（Unrealエディタ）をインストールする必要があります。  

## Unreal Engineのバージョン
Unreal Engine 5.5  

このバージョン以降のもであれば動作する可能性は高いですが、Unreal Engineのアップデートによっては正常に動作しなくなることはあります。  
このような場合はUnreal Engineのバージョンを下げる必要があります（1つの開発端末に異なる複数のバージョンのUnreal Engineをインストールできます）。  

なお、このゲームテンプレートのアップデート時に対応するUnreal Engineのバージョンが変更になることがあります（バージョンが変更になっても開発中のゲームテンプレートをアップデートしなければ従来通りに開発は継続可能です）。  

## Unreal Engineのインストール
インストールについてはUnreal Engine全般のテーマのため、詳しくは[Unreal Engineダウンロードページ](https://www.unrealengine.com/ja/download)や解説動画などを参考にしてください。  

「Unreal Engine インストール」や「Unreal Engine 入門」などのキーワードで探してみてください。  
このゲームテンプレートを編集する前に、入門者向け・初心者向けの動画などでイメージを掴んでおくのも良いと思います。  

## ゲームテンプレートをダウンロードする
GitHubページ上の緑色の［Code］ボタンを左クリックし、表示されるメニューの［Download ZIP］ボタンを左クリックします。  
案内に従ってそのZIPファイルを端末に保存してください。  

![テンプレートのダウンロードリンクの場所の図解](https://github.com/user-attachments/assets/8d907578-07b3-4d61-83eb-8d723b8d651f)

ダウンロードが完了したらそのZIPファイルをわかりやすい場所に展開（解凍）します。  
ゲーム開発ではSSDなどの高速ストレージに展開することを推奨します。  

またディレクトリ構造が深いとゲームエンジンの不具合に繋がることがあるため、浅いディレクトリ階層に展開してください（例えば「D:\UnrealProjects\HyakuTales」など）。  
あわせて親フォルダも含めてフォルダ名は半角英数字のみで構成するようにしてください（Unreal Engineに限らずゲーム開発ではフォルダ名・ファイル名に日本語があると不具合の原因になることがあります）。  

そして展開したUnreal EngineプロジェクトファイルであるHyakuTales.uproject（ファイル名は変更可能ですが、Unreal Engineの仕様により20文字以内推奨）をダブルクリックすれば、対応するUnreal Engineが起動し編集できるようになると思います。  
もし直接開けない場合は、次で説明するUnreal Engineを起動してからプロジェクトファイルを指定して開く方法を試してください。  

## Unreal Engineを起動する
起動するとプロジェクトブラウザが開くと思うので、左上の［最近使用したプロジェクト］を左クリックし、右下の［ブラウズ］ボタンを左クリックしてください（以前からUnreal Engineを使っている場合は自動的に最近開いていたプロジェクトが自動ロードされてしまっている場合があるので、その場合はそれを閉じてプロジェクトブラウザを開いてください）。  

そして先程ダウンロードして展開したゲームテンプレートのアンリアルプロジェクトファイル「HyakuTales.uproject」を開いてください。  
これでこのゲームテンプレートを編集できるようになると思います。  

## 動作確認
エディタ上でゲームをプレイするには、エディタ上部中央左付近の矢印マークが並んだエリアの右端にある点が縦に3つ並んだボタンを左クリックし、	［新規エディタウィンドウ（PIE）］ボタンを左クリックします。  

![エディタプレイ方法の図解](https://github.com/user-attachments/assets/0dd206c2-09c2-4216-88b5-b188111adc87)

なお、このプレイモードではタイトル画面や環境設定画面の表示言語の切替は正常に動作しません。  
またこのモードで言語を切り替えた場合は、エディタの表示言語も切り替わってしまうため注意してください。  

言語の切替も確認したい場合は［スタンドアロンゲーム］モードでプレイしてください（このモードは実行までに多少時間がかかります）。  

---

# オリジナル百物語カウンターの作り方
このゲームテンプレートのサンプルプログラムが百物語カウンターになっているので、3Dモデルの差替え・追加削除でオリジナル百物語カウンターを作ることができます。  
3Dモデリングできなくても、アセットストアなどで入手した3Dモデルを使うことができますし、Unreal EngineのRealityCaptureなどスマホのカメラなどから3Dモデルを生成することもできます。  

[デモ用に作った百物語カウンター](https://codelelou.booth.pm/items/6949715)では3Dモデリングは行っておらず、アセットストアで入手した和風環境と蝋燭のアセットを使って作成しました。  
* [和風環境: Japanese Farmhouse](https://www.fab.com/ja/listings/99f75379-1e36-4c6b-bd06-3a9931d48ecf)
* [蝋燭: Candle VFX](https://www.fab.com/ja/listings/98e82577-7a94-4a30-b5b4-b5a2d6073061)

ご自身の百物語配信用にオリジナル版を作るだけなら、「蝋燭」と「メイン画面」の編集だけ良いかと思います。  
第三者に公開する場合は必要に応じて「その他」を参考に編集を行ってください（特に使用するアセットや素材によってはクレジット表記が必要なため）。  

## 蝋燭の編集
蝋燭（/Content/HyakuTales/Blueprint/Actor/Candle/HT_BP_Actor_Candle_VefectsCandleVFX.uasset）は1つのプログラムになっており、点灯・消灯で見た目が変化するようになっています。  

デモで使用している[蝋燭アセット: Candle VFX](https://www.fab.com/ja/listings/98e82577-7a94-4a30-b5b4-b5a2d6073061)は個人ライセンス（2025年5月24日現在）なら無料で使用できるため、サンプルの蝋燭では簡単なStaticMesh（3Dモデル）やマテリアル（3Dモデルの表面の画像など）などの設定だけで使用できるようにしています。  
もしこのアセットを使用しない場合は、サンプルとして用意しているシンプルな蝋燭（/Content/HyakuTales/Blueprint/Actor/Candle/HT_BP_Actor_Candle_Simple.uasset）を参考にカスタマイズしてください。  

この蝋燭アセットはWeb上からでもエディタ上でも入手可能です。  
エディタで使えるように追加するには、エディタ上部の［ウィンドウ > （コンテンツを取得） > Fab］を左クリックしてFabプラグインを開き、Fabプラグインの検索機能やMy Libraryなどからこの蝋燭をアセットを開き、［Add to Project］ボタンを左クリックします。ダウンロード・追加が完了すれば、「Lelool」フォルダや「WalkingSimTpl」フォルダと並んで「Vefects」フォルダが作成されていると思います。  

蝋燭アセットがプロジェクトに追加できたら、先程の蝋燭ActorBlueprint（/Content/HyakuTales/Blueprint/Actor/Candle/HT_BP_Actor_Candle_VefectsCandleVFX.uasset）を開きます。  
そしてエディタ上部の［クラスのデフォルト］を左クリックし、「Candle Asset」の各項目に蝋燭アセットを設定していきます。  
- Wax（蝋燭のロウ）
  - WaxStaticMesh = SM_Melted_Candle_02_No_Wick
- Wick（蝋燭の芯）
  - WickStaticMesh = SM_Candle_Wick_01
  - WickLightsOnMaterial（灯火時の先端が光る芯） = MI_Candle_Wick_BP_01
  - WickLightsOutMaterial（消灯時の光っていない芯） = MI_Candle_Wick_Off_01
- Flame（蝋燭灯火時の炎）
  - FlameNiagaraSystemAsset（炎エフェクト） = NS_Candle_Flame_01
  - LightsOutSmokeNiagaraSystemAsset（消灯時の白煙エフェクト） = NS_Candle_Smoke_Mesh_01_Once

蝋燭ActorBlueprintの編集が完了したら、エディタ左上当たりの［コンパイル］ボタンを左クリックします。  
［ビューポート］タブから蝋燭の見た目が変わったことを確認できるかと思います。  

なおデモでは消灯時に効果音を鳴らしているのですが、これは［クラスのデフォルト］の［LightsOutSound］変数にサウンドソースを設定しておくことで鳴らせます（デモでは[効果音ラボの『マッチの火を吹き消す』](https://soundeffect-lab.info/sound/various/various3.html)を使用しています）。  

## メイン画面の編集
メイン画面（/Content/HyakuTales/Level/HT_Level_CandlesSpace.umap）は次のアクター（Unreal Engineではレベル上に配置する3Dモデルやライトなどのあらゆるものをアクターと呼びます）で構成されています。  
* Plane（床）
* 蝋燭×100本
* HT_BP_Actor_CandleManager(蝋燭を管理するプログラム)
* PlayerStart（プレイヤーキャラクターがスポーンされる開始位置）
* DirectionalLight（全体を照らす照明）
* 時計（アナログ時計プログラムのデモ用のため不要なら削除してください）

お好みで床を削除したり3Dモデルや照明などを配置したり、カメラを移動・回転したりしてください。  
必ず蝋燭の数は100本になるようにしてください。  

なおデモのように蝋燭間の距離が近いと、近づいた時に消す対象となる蝋燭の数が多くなり、操作性が悪くなる恐れがあります。  

どうしても蝋燭間の距離を近づけたい時は、蝋燭ActorBlueprint（/Content/HyakuTales/Blueprint/Actor/Candle/HT_BP_Actor_Candle_VefectsCadleVFX.uasset）を開き、エディタ左側の［コンポーネント］タブ内のInteractionComponentを選択し、エディタ右側に表示される［詳細］タブのパラメーターを調整してください。  
デモでは次のように調整しています。  
* OverrideMaxVisioDistance（インタラクト可能な距離） = 300（初期値500）
* OverridePlayerAngle（インタラクト可能なプレイヤーの視角） = 10（初期値25で、小さいと判定が悪くなり操作性が犠牲になります）

あわせて、デモでは蝋燭ActorBlueprintのInteractionViewArrow（コンポーネントタブ内）の位置を「(X=0.000000,Y=0.000000,Z=70.000000)」に調整しています。  
このInteractionViewArrowはインタラクト可能なプレイヤーの視角を判定する時の基準なのですが、対象（蝋燭）の位置とプレイヤーキャラクターの身長などで判定が異なるため、参考程度にしてください。  

可能であれば蝋燭の配置を見直し、蝋燭間との距離を開けるようにすることを推奨します。  

## その他

### メインメニューの編集
メインメニューは起動時に表示される画面で、終了もこの画面から行います（Alt+F4キーでも終了可能です）。  
ご自身の百物語配信で使用する場合など、メインメニューのカスタマイズが不要なら編集は不要です。  

メインメニュー（/Content/HyakuTales/Level/HT_Level_MainMenu.umap）は次のアクターで構成されています。  
* Plane（床）
* 蝋燭×6本
* HT_BP_LevelHelper_MainMenu（メインメニューのUI表示などを行っているプログラム）
* CineCameraActor（蝋燭6本を写すカメラ）

お好みで床を削除したり3Dモデルや照明などを配置したり、カメラを移動・回転したりしてください。  

サンプルではHT_BP_LevelHelper_MainMenuが蝋燭6本を参照しているため、蝋燭を削除する場合はその前に、HT_BP_LevelHelper_MainMenuを選択し［デフォルト > Candles］変数の右側にある削除ボタン（ゴミ箱アイコン）を左クリックして参照を解除してください。  
ちなみにこの蝋燭6本の参照は、メインメニュー表示中にメニュー内のボタンのホバー状態に応じて点灯する蝋燭が変化するギミックに使用しているだけです。  

### 百物語オプションUIの編集
百物語オプションUI（/Content/HyakuTales/UI/HT_WBP_HyakuTalesOptions.uasset）には3つの項目があります。  
- カウンター表示（非表示 or 表示位置）
- カウンター通知（蝋燭消灯後に画面右上から残りの本数を通知するの設定）
- 時計（アナログ時計プログラムの技術用デモで、現在時刻にするかホラーゲームなどで使える壊れた表現を行うかの設定）

メイン画面で時計を削除した場合は、時計のテキストと項目を選択して削除すれば良いです。  
削除後に時計が表示されていた余白が気になる場合は、［GridPanel］の［フィル ルール > Row Fill］の［インデックス[2]］を削除すれば良いかと思います。  

編集が終わったらエディタ左上の［コンパイル］ボタンを左クリックしてください。  

### プロジェクト設定
エディタ上部の［編集 > プロジェクト設定］を左クリックしてプロジェクト設定を開きます。  

プロジェクト設定の［プロジェクト > 説明］を開き、［Unreal Editorについて > プロジェクト名］と［表示 > プロジェクトが表示されたタイトル］にゲームタイトルに入力します（ゲーム起動時のウィンドウ名に使用されます）。

なお、［Unreal Editorについて > プロジェクト名］はWindowsのタスクマネージャーのアプリの表示で影響があるようです。
他の項目は特に変更しなくても問題ないかもしれませんが、［Unreal Editorについて > プロジェクトバージョン］が未入力だとパッケージ化の際などにエラーが発生し失敗するようです。

#### MegaLight
プロジェクト設定の［エンジン > Rendering > 直接ライティング > MegaLight］にチェックを入れると、パフォーマンス（FPS値）の向上が期待できます。  
従来は大量のライトを配置（サンプルの蝋燭は1本ずつにライトがあるため、100個以上のライトを配置していることになります）すると大幅なパフォーマンスの低下の原因となっていましたが、MegaLightは効率的に大量のライトを処理できるようになります。  

ただしMegaLightはUnreal Engineの実験的機能で、現時点では製品版での使用は非推奨であり、特にオリジナル百物語カウンターの販売する予定であれば注意してください（禁止されているわけではありません）。  
特にMegaLightはUnreal Engine 5.5でリリースされた新しい機能のため、特に注意が必要です。  

なおデモではMegaLightを有効にしています。  

### プロジェクトデータ データテーブル
メインメニューやクレジット表記などに使用するゲームタイトルやバージョン情報、著作権表示などをまとめてプロジェクトデータとしてデータテーブルファイルで管理しています（実際に使用されるデータテーブルは［プロジェクト設定 > プロジェクト > マップ&モード > GameInstance > ゲームインスタンス］で指定されたGameInstanceブループリントのProjectDataTable変数で指定されたデータテーブルになります）。  

サンプルのプロジェクトデータ（/Content/HyakuTales/Blueprint/ProjectData/HT_DataTable_ProjectData.uasset）を開いて、必要な項目を編集してください。  
* Title: メインメニューやUnreal Engineのクレジット表記に使用
* Version: メインメニューの左下部に表示されます（初リリース時は「Ver.01.00.00」などどすると良いでしょう）
* Copyright: メインメニューの右下部に表示されます（「© CodeLelou 2025」のように「著作権マーク 権利者名 リリース年」という書式が一般的なようです）
* RealeaseYear: Unreal Engineのクレジット表記に使用
* UnrealEngineCredit: Unreal Engineのクレジット表記のフォーマットで、特に理由が泣ければ編集しないようにしてください。
* TemplateCredit: このゲームテンプレート「Hyaku Tales Sim Template」のライセンス表記で編集しないでください。
* OtherCredits: Unreal Engineとこのゲームテンプレートの以外のライセンス表記を入力します。

UnrealEngineCredit/TemplateCredit/OtherCreditsに関しては、メインメニューのインフォメーションボタンで表示されるインフォメーションUIのクレジットタブに表示されます。  
ライセンスにもよりますがこのようなライセンス・クレジットの表記は必ずしもゲーム内で表示しなければならないわけでなく、ストアページへの記載やゲームファイルに同梱しても良い場合、ゲームクリア後のエンドロールなどで表記する場合など色々です。  
サンプルでは記載忘れを起こしにくいように、インフォメーションとして表示する機能を実装しました。  

またOtherCreditsに関して、基本的にゲームのアセットストアで入手したものは追加の規約などが無い限りは無料アセットでも特にクレジット表記は不要なことが多いようです。  
例えばデモではアセットストア以外で入手した効果音素材を使用しているため、そのクレジット表記をここに記載しています。  
他にもフリーフォントなどを埋め込む場合もクレジット表記が必要になることが多いかと思います。  

なお無料のものだからといってクレジット表記を蔑ろにしてはいけません。  
もしクレジット表記が使用条件に含まれている場合は、その条件を守っている場合にのみ無料で使用できるのであって、その条件を守っていない場合は無料で使用することはできません。もちろん条件を守らなかったからと言って法外な使用料の請求は法的には認められないでしょうが、割高な使用料の支払いの可能性は否定できません。  

### インフォメーション
メインメニューの［インフォメーション］ボタンで表示される内容は、インフォメーションコンテンツ（/Content/WalkingSimTpl/UI/Info/WST_WBP_Info_Content.uasset）のものになり、ゲームの概要タブとクレジットタブに分かれたUIになっています。  

概要タブに関しては必要に応じて、［デザイナー］の［階層］タブの［SummaryRichTextBlock］を選択し、右側に表示される［詳細］タブの［コンテンツ > Text］を編集してください。  
なおクレジットタブに関しては基本的に編集は禁止です。  

---

# パッケージ化（配布用EXEファイル作成）
パッケージ化することで、作ったゲームを他のPCやスマートフォンなどで遊べるようになります。  
Unreal Engine 5はパソコンやスマートフォン以外にも、ゲームコンソール（Switch/PlayStation/Xboxなど）にも対応しています。  
※このテンプレートはWindows向けの動作確認しかしていません。  

どのプラットフォーム向けにパッケージ化するにしても、そのプラットフォーム向けに別途SDKのインストールなど準備が必要です。  
もしすでにUnreal Engineでゲームを開発していてパッケージ化の準備が完了しているのであれば、すぐにパッケージ化できるかと思います。  

ただパッケージ化に関してはこのゲームテンプレート固有のテーマではないため、詳しいパッケージ化の手順などについては公式ドキュメントや動画などを参考にしてください。  

「UE5 パッケージ化」などのキーワードでネットや動画を検索してみてください。  
なおUnreal Engineのバージョンや開発環境がWindowsかMacなどかによって必要なものや手順が異なることがあるため、1つの情報だけでは上手くできない可能性があります。  

もしパッケージ化が失敗する場合、まずはこのゲームテンプレートを編集せずにそのままパッケージ化を試してみても良いかもしれません。  
この時点で失敗する場合はパッケージ化の準備が不十分であると考えられますし、成功する場合はカスタマイズしたゲーム側に問題があると考えられます。  

なおパッケージ化に関しては普通にプログラミングできる人でも苦戦することは珍しくない躓きポイントですので、上手くいかなくてもあまり気にする必要はありません。  
ゲーム開発者でもパッケージ化経験がない人は少なくないでしょうし、そもそもゲームを完成することなく頓挫することも珍しくはありません。  
そのためにパッケージ化に関する情報自体が少ないです。  

## パッケージ化の手順
Windows向けのパッケージ化の準備が完了している場合、次の手順でパッケージ化可能です。  
細かい設定を行うことでパッケージ化したファイルを小さくしたり暗号化したりもできますが、ここでは割愛します。  

![パッケージ化ボタン位置の図解](https://github.com/user-attachments/assets/d977798d-4556-4759-a494-533d7c1c56c0)

エディタ上部中央の［プラットフォーム］ボタンを左クリックしてメニューを開き、［コンテンツ/SDK/デバイス管理 > Windows］を開きます。  
この時、［Windows］の前にビックリマークアイコンが表示されている場合はパッケージ化の準備が完了していないと思われます。  
そして［バイナリ コンフィギュレーション > シッピング］が有効（白い点）になっていなければ、それを左クリックして有効にしてください。  
［シッピング］が有効であれば、［コンテンツ管理 > プロジェクトをパッケージ化］を左クリックしてください。  
保存先のディレクトリを聞かれるので、パッケージ化用にわかりやすいフォルダを作って指定します。  

これでパッケージ化の処理がはじまります。  

パッケージ化時間はゲームの内容や開発端末性能（おそらくCPU性能）で大きく異なります。  
ハイスペックゲーミングPC程度の環境であれば数分ですが、ロースペックPC環境だと数十分以上掛かる可能性があります。  

完了後は成功しても失敗しても音で通知してくれるはずです。  

パッケージ化が成功していれば、指定したフォルダに「Windows」フォルダができていて、その中に配布用ファイル一式がまとめっていると思います。
配布する時はそのWindowsフォルダをZIP化するなどして公開すると良いでしょう（Steamなどのストアで公開する時は、ストアの指示に従ってください）。  

設定などを変更していなければ「HyakuTales.exe」をダブルクリックすればゲームが起動するはずです。  
実は恐ろしい話ですが、エディタ上では問題なく動作していても、パッケージ化すると動作しなくなることは珍しくなく、配布用のファイルでもテストプレイが必要です（ゲームエンジンそのものにもバグはありえます）。  

---

# フォルダ構成（プログラムなどメインのコンテンツフォルダ）
* HyakuTales … 百物語カウンターの本体
* Lelool … 共通プログラムファイルで原則変更非推奨
* Localization … 国際化ファイルで直接変更非推奨（Unreal Engine標準のローカライゼーションダッシュボードが生成するフォルダ・ファイル）
* WalkingSimTpl … ウォーキングシミュレーターゲームのテンプレート

もし百物語カウンター以外のウォーキングシミュレーターゲームなどを作る場合は、WalkingSimTplフォルダをそのまま使用・編集・ファイル追加すると便利かと思います。  
HyakuTalesフォルダに関しては削除しても構いません（アナログ時計のサンプルプログラムなどを使う場合は、WalkingSimTplフォルダに移動すると良いでしょう）。  

---

# 共通システム

## インタラクション
インタラクションはアイテムを拾ったりドアの開閉などに使うもので、サンプルの百物語カウンターでは蝋燭を消すアクションがこれにあたります。  
このインタラクション機能はFPS視点向けのため、TPS視点や固定カメラだと期待する判定が行われないため操作性の低下の恐れがあります。  

ゲームでは頻繁に使われる機能のため、インタラクション可能ActorBlueprintのベース（/Content/WalkingSimTpl/Blueprint/Actor/WST_BP_Actor_Interaction_Base.uasset）を作成済みです。  
このActorBlueprintを複製するか子クラスとして、拾うことができるアイテムなどのActorBlueprintを作ると便利です。  
もしアセットストアで入手したActorBlueprintにインタラクション機能を追加したい時は、そのActorBlueprintの親クラスが「Actor」であれば、その親クラスを「WST_BP_Actor_Interaction_Base」すれば使えるようになるはずです（親クラスの変更は［クラス設定 > クラスオプション > 親クラス］から行えます）。  

参考までにインタラクション可能なActorBlueprintを作る共通となる手順を紹介します。  
* ActorComponentとしてWST_BP_InteractionComponent_Actor（/Content/WalkingSimTpl/Component/Interaction/WST_BP_InteractionComponent_Actor.uasset）を追加する。
* インタラクション用OverlapCollisionを追加する（大き目のサイズにし、プレイヤーキャラクターがオーバーラップしている時にインタラクションの判定処理が行われる）。
* インタラクション用ArrowComponentを追加する（プレイヤーキャラクターの視界にActorBlueprintが入っているかの基準として使われる）。
* Lelool_BPI_InteractionActorインターフェース（/Content/Lelool/Component/Interaction/Actor/Lelool_BPI_InteractionActor.uasset）を実装する。
* Lelool_BPI_InteractionActorインターフェースのGetInteractionActorVisioTargets関数がインタラクション用ArrowComponentを返すようにする。

これらの手順は共通して必要なもので、ActorBlueprint別に「蝋燭を消す」や「アイテムを拾う」や「ドアを開ける」といった個別のアクションに対応する必要があります。  

まずはインタラクトが可能になった時に画面下部のインタラクションUIにメニューを表示する方法です。  
これはLelool_BPI_InteractionActorインターフェースのGetInteractionActorActions関数を使います。  
サンプルのHT_BP_Actor_Candle_Base（/Content/HyakuTales/Blueprint/Actor/Candle/HT_BP_Actor_Candle_Base.uasset）では、蝋燭点灯時にLightsOutAction（消灯アクション）として消灯用GameplayTagを返すようになっています。  
もしこれがドアであれば、ドアが閉じていることをプログラムでチェックした上でドアを開ける用GameplayTagを返したり、施錠用GameplayTagも一緒に返すことだってできます。  

次はプレイヤーがインタラクションメニューからアクションを実行した場合の処理になります。  
これにはLelool_BPI_InteractionActorインターフェースのCallInteractionActorActionイベントを使います。  
サンプルのHT_BP_Actor_Candle_Base（/Content/HyakuTales/Blueprint/Actor/Candle/HT_BP_Actor_Candle_Base.uasset）では、GameplayTag引数が消灯用GameplayTagと同じかチェックして、同じであれば消灯処理を実行しています。  
もしこれがドアであれば、ドアを開ける用GameplayTagと同じならドアを開ける処理を、施錠用GameplayTagと同じであれば施錠処理を実行します。  

なおインタラクト可能なActorBlueprintは可能な限り距離を離して配置することを推奨します。  

デモでは参考としてあえて100本の蝋燭を近づけて配置する方法を実現していますが、個々の蝋燭の判定処理を小さくするなどの調整が必要となるため、ゲームによっては判定の悪さからゲーム体験を損なう恐れがあります。  
判定の調整はWST_BP_InteractionComponent_Actorを選択し、エディタ右側に表示される［詳細］タブのパラメーターで可能です。  
デモでは次のように調整しています。  
* OverrideMaxVisioDistance（インタラクト可能な距離） = 初期値500
* OverrideObjectAngle（インタラクション用ArrowComponentの視角） = 初期値360（ドアスコープや鍵穴などを覗くアクションの場合に片側からしか覗けないようにするなどの使い方が可能）
* OverridePlayerAngle（インタラクト可能なプレイヤーの視角） = 初期値25（小さいと判定が悪くなり、逆に大きすぎると背後のアイテム入手やドアの開閉が可能になってしまいます）

他にもインタラクション用ArrowComponentの位置や角度を変更することでも調節できる場合があります。
またプレイヤーキャラクターの身長やActorBlueprintとの位置関係によっても判定に影響が出ることがあります。  

## 時計
ホラーゲームの演出用の小物としてアナログ時計のサンプルプログラムを用意しています（デジタル時計にも対応しています）。  

時間を指定することも、プレイヤーの端末のローカル時間に連動することも、高速回転・逆回転・高速逆回転・進まない故障演出（秒針の痙攣）などが簡単にできます。  
サンプルのメインメニューやポーズメニューから時計の状態を変更できるオプションを用意しているので、どのような機能なのかお試しください。試すとわかるかと思いますが、高速回転演出を行うのであれば秒針が無い時計の方が良いと思いますし、逆回転や進まない故障演出（4時44分44秒）では秒針が無いとわかりにくいとは思います。  

サンプルの時計はゲームに使用するにはチープすぎると思うので、時計のベース用ActorBlueprint（/Content/HyakuTales/Blueprint/Actor/Clock/HT_BP_Actor_Clock_Base.uasset）の子クラスを作って、時計の本体・短針・長針・秒針（必要なら）の3Dモデルを追加すると良いでしょう。  
時計の針をそれぞれ所定のSceneComponentに配置すると、自動的に時間に合わせて回転します（サンプルも参考にしてください）。
* HourHandScene（短針/時）
* MinuteHandScene（長針/分）
* SecondHandScene（秒針/秒）
使用する3Dモデルによって向きが異なるため、実際にエディタ上でゲームをプレイする時に確認してください。

時計の開始時刻は時計ActorBlueprintのTime変数で指定できます（4時44分44秒なら「+00000000.04:44:44.000000000」とします）。  
また秒針がある時計ではお好みでIsMinuteUnitHand変数にチェックを入れると良いと思います（長針が毎秒動くか00秒の時に動くかどうか）。  

時計の電源や故障の設定は、時計ActorBlueprintを開いてエディタ左側の［コンポーネント］タブの［ClockComponent］を選択し、右側に表示される［詳細］タブの［デフォルト > Setting］で行います。  
* Realtime（現在時刻を有効にするか）
* Power（時計を動かすかどうか）
* Reverse（逆回転するかどうか）
* Paralysis（進まない痙攣演出するかどうか）
* Speedy（高速回転するかどうか）

優先度の高い順から「Power」「Paralysis」「Reverse/Speedy」「Realtime」「時計ActorBlueprintのTime変数」となります。  

---

# 応用編

## 国際化（多言語対応）
Unreal Engine標準の[ローカリゼーションダッシュボート](https://dev.epicgames.com/documentation/ja-jp/unreal-engine/localization-tools-in-unreal-engine?application_version=5.4)を使ってゲーム内メニューの国際化に対応しています（エディタ上部の［ツール > ローカリゼーションダッシュボート］を左クリックして開けます）。  
ただしローカリゼーションダッシュボートは実験段階の機能のため、不具合が発生しやすかったり、Unreal Engineのアップデートで大幅な仕様変更が行われる可能性もあります。  

国際化対応が難しかったり負担が大きい場合は、割り切って国際化はあきらめても大きな問題はないでしょう。  
国際化対応を行わない場合は、メインメニューと環境設定にある言語設定の項目を非表示にしてください（削除しても良いですが、環境設定だと言語設定を参照しており手間が増えます）。  

なおエディタ上で言語の切替の動作確認を行う場合は「スタンドアローンゲーム」としてプレイする必要があるようです（これ以外のモードでテストしてしまうとエディタの表示言語が変更されてしまう恐れがあります）。  
またパッケージ化した場合に国際化が正常に動作しないこともあるため、パッケージ化後にも正常に動作するかテストした方が良いでしょう。  

## 操作方法のキー設定
キャラクターの操作やメニュー表示などのキーはそれぞれ設定ファイルが分かれています（詳しくは[Unreal EngineのEnhanced Input](https://dev.epicgames.com/documentation/ja-jp/unreal-engine/enhanced-input-in-unreal-engine)などを参照してください）。  

* キャラクター: Lelool_IMC_Character（/Content/Lelool/Input/Character/Lelool_IMC_Character.uasset）
* ダイアログ（会話）: Lelool_IMC_Dialogue（/Content/Lelool/Input/Dialogue/Lelool_IMC_Dialogue.uasset）
* インタラクト（アイテム取得やドアの開閉などのアクションメニュー）: Lelool_IMC_Interaction（/Content/Lelool/Input/Interaction/Lelool_IMC_Interaction.uasset）
* 一時停止: Lelool_IMC_Pause（/Content/Lelool/Input/Pause/Lelool_IMC_Pause.uasset）

キーは変更・追加・削除可能で、特定の操作を無効化したい場合はキーを［None］に設定します。  
テンプレートではサンプルとしてメインメニューとポーズメニューに操作方法のボタンを表示しているため、操作方法を変更する様な場合は操作方法ボタンを非表示にしたり操作方法UIを編集してください。  

「ダッシュ」「しゃがみ」「ズーム」に関しては、サンプルとして実装しているだけでゲーム内容によっては無効化しても良いと思います。  
プレイヤーによっては操作方法からメタ読みして攻略を考えることもありゲーム体験を損なわせてしまうことがあるかもしれません。  
「ダッシュ」に関しては移動の遅さのストレスを軽減にも繋がるため、ホラーゲームなどダッシュで雰囲気や恐怖感を損なうなどの理由がなければ有効のままでも良いかと思われます。  

### 操作方法画面のカスタマイズ
操作方法画面はWST_WBP_Control_Contentウィジット（/Content/WalkingSimTpl/UI/Control/WST_WBP_Control_Content.uasset）になります。  

無効にする操作がある場合は、その行の各項目を削除するか、［Visibility］を［Collapsed］に設定し非表示にします。  
必要に応じて他の操作の表示位置を調整したり、GridPanelのフィルルールのFowFill配列を変更してください。  

## ゲームの画質について
初期設定ではUnreal Engineの高画質なグラフィックが有効になっており、処理負荷が高く、低スペックなプレイ環境では快適性が犠牲になってしまいます。  
特に「Lumen」の影響が大きいと思われます。  

LumenはUnreal Engine 5の新機能で、完全に動的なグローバルイルミネーションおよび反射のシステムです。  
これにより自動に光と影がリアルに近い表現となり、初心者でもそれなりに見栄えの良いグラフィックのゲームを作れるようになります。  

Lumenは次世代コンソールやハイエイド環境向けに設計されており、PlyaStation 5やXbox Series Xやそれに匹敵する性能のゲーミングPC向けになっています。  
Unreal Engine 5.5ではLumenで60FPSを出すことは可能になってますが、逆にそれだけ負荷の大きい機能でもあります。  

Lumenを無効化すれば大幅に負荷を軽減できるのですが、グラフィックをかなり犠牲することになります。  
ポストプロセスなどで対応可能のようですが、それには知識・スキルが必要になるようです。  

なおこのゲームテンプレートでは環境設定で5段階の画質から選べるようにし、各種パラメーターを調整して画質とパフォーマンスのバランスを図っています。  

そもそもゲームの最適化は知識・スキルが求められるものですし、特に個人開発では動作確認できる端末が開発用パソコンの1台だけというのも珍しくないので限界もあります。  
画質を諦めてパラメーターを全体的に低めにするか、要求スペックを最低動作環境でも高めに設定するのが現実的かもしれません。  

### 画質のカスタマイズ
特に画質にこだわらない、もしくは画質を妥協してでも要求スペックを下げたい場合、大きく2つの対応方法があります。  

* プロジェクト設定
* ゲーム内画質設定（中・上級者向け）

#### プロジェクト設定
プロジェクト設定はエディタ上部の［編集 > プロジェクト設定］を左クリックで開きます。  
なおプロジェクト設定から色々な変更を行えますが、影響範囲が大きいものもあるためよくわからないで変更しないように注意してください。  

簡単な画質（負荷軽減）に関係する項目を紹介します。  

##### ターゲットハードウェア
プロジェクト設定の［プロジェクト > ターゲットハードウェア］を開きます。  
デフォルトでは「Desktop」「Maximum」と最高設定になっているので必要に応じて下げてみてください（変更後はプロジェクト設定に指示に従ってエディタの再起動が必要になると思います）。  

![プロジェクト設定のターゲットハードウェアの設定個所の図解](https://github.com/user-attachments/assets/993b3a04-3303-4c95-93e2-9c759caa16d0)

##### アンチエイリアス手法
アンチエイリアスは曲線などをボカして綺麗に見せる処理です。  
当然、品質重視にすると負荷は高くなります。  

プロジェクト設定の［エンジン > Rendering］を開き、［Default Settings > アンチエイリアス手法］から設定可能です。  

![アンチエイリアス手法の設定個所の図解](https://github.com/user-attachments/assets/321bdaef-f181-4bf5-ad36-30999d288fa7)

初期設定の「TSR」は負荷が高く「TAA」「FXAA」「None（アンチエイリアス無し）」の順に負荷が下がります（画質も下がる）。  
※「MSAA」はよくわかりませんでした。

#### ゲーム内画質設定（中・上級者向け）
ゲーム内の環境設定で画質を5段階から選択できるようになっていますが、そこで行われる画質設定はWST_BP_GraphicSettingComponentアクターコンポーネント（/Content/WalkingSimTpl/Component/GraphicSetting/WST_BP_GraphicSettingComponent.uasset）で切り替えています。  

このファイルをダブルクリックして開き、エディタの上あたりに表示される［クラスのデフォルト］ボタンを左クリックします。  
そしてクラスのデフォルトの［品質 > Qualities］に配列として5段階の画質設定を設定しています。  

上から順に「最低画質」「低画質」「標準画質」「高画質」「最高画質」となっています。  
ただしこの順番は［品質 > QualityMapping］変数のIndex値と紐づいており、この値を変更すると画質設定にも影響します（変更非推奨）。  

* 1 = 最低画質
* 3 = 低画質
* 5 = 標準画質
* 7 = 高画質
* 9 = 最高画質

そして画質別にUnreal EngineのGameUserSettingsで指定できる画質の値をプリセットとして設定しています。  
なおこれらの値を下げると顕著に画面表示に影響することがあり、中にはゲームプレイに影響しかねないので、画質を下げる変更を行う時はテストプレイで変化を確認するようにしてください。特に明るい所や暗い所、一部のエフェクトでのみ変化が顕著になることがあるので、影響がありそうな箇所は特に注意してください。 

比較的簡単に変更できる項目は「ResolutionScaleNormalized」です。  
数値を下げると動画の解像度を下げた時のように、単純に画面が荒くなります。  

「ShadowQuality」（影）を0（無効化）にすることで負荷の大幅な軽減が期待出来はしますが、影がなくなるだけで顕著に見栄えが悪くなる可能性が高いので注意してください。  
数値を下げると、対象物に近づいた時に遅れて影が描写するため不自然になる恐れがあります。  

また画質ごとに「PostProcessVolume」を設定でき、ここで「Lumen」の無効化ができます。  

##### 初期画質の変更（中・上級者向け）
画質の初期値はWST_BP_SaveGame_Settingsブループリント（/Content/WalkingSimTpl/Blueprint/SaveGame/WST_BP_SaveGame_Settings.uasset）で設定しています。  

［表示 > ImageQuality］変数の値が、WST_BP_GraphicSettingComponentのQualityMapping変数と紐づいています。  
デフォルトでは初期値が「3」（低画質）になっていると思われます（低スペック環境でゲームを起動してしまった場合に重すぎて環境設定画面を開くのが困難になる恐れを考慮し、保険として初期値を低画質にしています）。  

例えばこの値を「5」に変更すると初期画質が「標準画質」になります。  
この値は環境設定で変更されるセーブ・ロード対象の値であり、プレイヤーが変更しておりセーブ・ロードが完了していると、次回以降はプレイヤーが設定した画質で描画されます。  

## サウンドの種類の設定方法
ゲーム内の環境設定からBGM/効果音/ボイスの音量を個別に変更できるようになっています。  
プロジェクトにインポートしたサウンドファイルに種類に応じたサウンドクラスを設定することで、これらの音量設定が反映されるようになります。  

サウンドクラスはインポートしたサウンドファイル（サウンドウェーブ）を開き、［詳細］タブの［サウンド > Class］から変更可能です。  
サウンドの種類によって次のいずれかのサウンドクラスを設定してください。  

* BGM = WST_SoundClass_BGM
* 効果音 = WST_SoundClass_SoundEffect
* ボイス = WST_SoundClass_Voice

![サウンドクラスの設定方法の図解](https://github.com/user-attachments/assets/d576307f-dabb-4d77-be26-a3030926c0ef)

## フォント
Unreal Engine標準のフォントは日本語対応にはなっていますが、日本人からすると不自然に感じるものが一部あります。  
フォントをゲームに組み込むことも可能ですので、余力があれば自作ゲームに組み込んでも良いかもしれません。  

---

# よくある質問
このゲームテンプレートはライセンスが非常に緩いMITライセンスで公開しており、ライセンスを守ってライセンス表記さえすれば非常に自由度が高いです（デフォルトでゲーム内にクレジット・ライセンス表記する機能を備えているため、カスタマイズして非表示・無効化・削除していなければこのゲームテンプレートのライセンス表記は行えているはずです）。  

もちろん、他に併用するライブラリなどがある場合はそれらのライセンスの確認は必要です。  

## サンプルゲームをゲーム実況しても良いですか？
問題ありません。  

## このゲームテンプレートで作ったゲームを有料で販売しても良いですか？
問題ありません。  

## このゲームテンプレートで作ったゲームのソースコードは非公開でも良いですか？
問題ありません。  

## このゲームテンプレートの有料教材を作っても良いですか？
問題ありません。  

## このゲームテンプレートを有料の勉強会の教材に使っても良いですか？
問題ありません。  

## このゲームテンプレートで百物語カウンターやウォーキングシミュレーターゲーム以外を作っても良いですか？
問題ありません。  

## このゲームテンプレートの一部を別のゲームに流用しても良いですか？
問題ありません。  

## このゲームテンプレートで有償の開発代行・受注開発を行っても良いですか？
問題ありません。  

## エディタのレイアウトが変になってしまったのですが？
エディタ上部の［ウィンドウ］から［レイアウトをロード > デフォルトのエディタレイアウト］を左クリックすれば、エディタのレイアウトが初期状態に戻ります。  

![デフォルトのエディタレイアウトに戻すための項目の位置の図解](https://github.com/user-attachments/assets/d6cea8ce-18cb-4067-8066-1fbeeb3c8cec)
